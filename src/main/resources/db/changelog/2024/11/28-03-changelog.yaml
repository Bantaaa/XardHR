databaseChangeLog:
  - changeSet:
      id: 1732785780374-31
      author: Youcode
      objectQuotingStrategy: QUOTE_ONLY_RESERVED_WORDS
      changes:
        - createProcedure:
            procedureName: prevent_user_deletion
            path: functions/prevent_user_deletion.sql
        - sql:
            sql: >
              CREATE OR REPLACE FUNCTION prevent_user_deletion()
              RETURNS TRIGGER AS $$
              BEGIN
                  RAISE EXCEPTION 'Deletion of user records is not allowed.';
                  RETURN NULL;
              END;
              $$ LANGUAGE plpgsql;

        - sql:
            sql: >
              CREATE TRIGGER prevent_user_deletion_trigger
              BEFORE DELETE ON "user"
              FOR EACH ROW
              EXECUTE FUNCTION prevent_user_deletion();